#!/bin/sh
# WRAPPER: IMPORTANT DON'T CHANGE ANYTHING HERE
[ -z "$BASH_VERSION" ] && exec bash "$0" "$@"
unset HISTSIZE

__BASE_REPO__="nene"
__DIR__="${HOME}/.basher/cellar/packages/luisadha/${__BASE_REPO__}"

if [[ $# -eq 0 ]]; then
  mode="offline" 
fi

for arg in "$@"; do
  case "$arg" in
    --help)
      echo -e "You will install 1 plugin (ztme-toolbox) this will be added to ~/bin after installation is complete";
      ;;
    --mode=*)
      MODE_ARG="${arg#--mode=}"
      mode="online"
      ;;
  esac
done

if [[ "$MODE_ARG" == "online" ]]; then
mode="online"
  read -r nene_web <<EOF
$(curl -s https://not-echo-not-true.carrd.co |
  html2text |
  grep -oP '(?<=\])\(\K[^)]+' |
  grep '^https\?://' |
  grep -E 'github\.com|github\.io|luisadha\.my\.id' |
  sort -ur |
  awk '{print $0 "\t" gensub(".*/", "", "g", $0)}' |
  fzf --with-nth=2 --prompt="Choose (script): " --delimiter='\t') 
EOF
  [ -z "$nene_web" ] && echo -e "\nCaught ^C" || . <(curl -sL "$nene_web")
  exit 
elif [[ "$MODE_ARG" == "default" ]]; then
mode="default"
elif [[ -n "$MODE_ARG" ]]; then
  echo "Butuh argumen"
  exit 3
fi

if [[ "$mode" == "default" || "$mode" == "offline" ]]; then
  exec python3 "${__DIR__}/not-echo-not-true.py"
fi
