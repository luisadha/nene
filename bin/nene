#!/bin/sh
# WRAPPER: IMPORTANT DON'T CHANGE ANYTHING HERE
[ -z "$BASH_VERSION" ] && exec bash "$0" "$@"
unset HISTSIZE

__BASE_REPO__="nene"
__DIR__="${HOME}/.basher/cellar/packages/luisadha/${__BASE_REPO__}"

if [[ $# -eq 0 ]]; then
  mode="offline" 
fi

for arg in "$@"; do
  case "$arg" in
    -u|--select-url)
      mode="url"
      ;;
    --help)
      cat <<'EOF'
Nene â€” My collections curl-based script, All in one place. Mirror from https://github.com/luisadha/not-echo-not-true
Usage :
  -u    --select-url    Select and open the link.
        --mode=[online] Select and run through the link.
        --help          Print this message.
EOF
      ;;
    --mode=*)
      MODE_ARG="${arg#--mode=}"
      mode="online"
      ;;
  esac
done

if [[ "$MODE_ARG" == "online" ]]; then
mode="online"
read nene_web < <(
  curl -s https://not-echo-not-true.carrd.co |
    html2text |
    grep -oP '(?<=\])\(\K[^)]+' |
    grep '^https\?://' |
    grep -E 'github\.com|github\.io|luisadha\.my\.id' |
    sort -ur |
    awk '{print $0 "\t" gensub(".*/", "", "g", $0)}' |
    fzf --with-nth=2 --prompt="Choose (script): " --delimiter='\t')

[ -z "$nene_web" ] && echo -e "\nCaught ^" || . <(curl -sL $nene_web)

elif [[ "$MODE_ARG" == "default" ]]; then
mode="default"
elif [[ -n "$MODE_ARG" ]]; then
  echo -e "Invalid value, you mean \`--mode=online' ?"
  exit 3
fi

if [[ "$mode" == "default" || "$mode" == "offline" ]]; then
  exec python3 "${__DIR__}/not-echo-not-true.py"
elif [[ "$mode" == "url" ]]; then
  read url < <(curl -s https://not-echo-not-true.carrd.co |
  html2text |
  grep -oP '(?<=\])\(\K[^)]+' |
  grep '^https\?://' |
  grep -E 'github\.com|github\.io|luisadha\.my\.id' |
  sort -ur | fzf --prompt="Choose URL: " |
  xargs -r termux-open-url);
else
  echo -e "Invalid option."
fi
