#!/bin/sh
# WRAPPER: IMPORTANT DON'T CHANGE ANYTHING HERE
[ -z "$BASH_VERSION" ] && exec bash "$0" "$@"

unset HISTSIZE

__BASE_REPO__="nene"
__DIR__="${HOME}/.basher/cellar/packages/luisadha/${__BASE_REPO__}"

online_mode=0

# Tangani opsi lokal
while getopts ":ho:" opt; do
  case "$opt" in
    h)
      echo "Penggunaan: $0 [-h] [-o]"
      echo "  -h        Tampilkan bantuan"
      echo "  -o        Aktifkan mode online"
      exit 0
      ;;
    o)
      online_mode=1
      ;;
    \?)
      echo "Opsi tidak dikenal: -$OPTARG" >&2
      exit 1
      ;;
  esac
done

shift $((OPTIND - 1))

# Trap Ctrl+C
trap 'echo; echo "Caught ^C"; exit 1' INT

if [ "$online_mode" -eq 1 ]; then
  nene_web=$(
    curl -s https://not-echo-not-true.carrd.co |
      html2text |
      grep -oP '(?<=\])\(\K[^)]+' |
      grep '^https\?://' |
      grep -E 'github\.com|github\.io|luisadha\.my\.id' |
      sort -ur |
      awk '{print $0 "\t" gensub(".*/", "", "g", $0)}' |
      fzf --with-nth=2 --prompt="Choose (script): " --delimiter=$'\t'
  )
  if [ -z "$nene_web" ]; then
    echo -e "\nCaught ^C or no selection"
    exit 1
  fi
  . <(curl -sL "$nene_web")
fi

exec python3 "${__DIR__}/not-echo-not-true.py" "$@"
